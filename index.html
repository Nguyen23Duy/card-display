<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Card Display - Always Latest</title>
  <style>
    body {
      margin: 0;
      background: black;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      color: white;
      font-family: sans-serif;
    }
    img {
      max-width: 90%;
      max-height: 80%;
    }
    #meta {
      margin-top: 12px;
      font-size: 14px;
      opacity: 0.7;
    }
    button {
      margin-top: 10px;
      padding: 6px 12px;
      background: #333;
      border: 1px solid #666;
      color: white;
      cursor: pointer;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <img id="card" alt="Loading latest card...">
  <div id="meta">Đang tải…</div>
  <button onclick="showNewest()">Refresh</button>

  <script>
    const OWNER = "Nguyen23Duy";
    const REPO = "card-display";
    const BRANCH = "uploads";   // đổi sang "main" nếu bạn deploy từ main
    const FILE = "latest.png";

    async function showNewest() {
      try {
        // 1) Lấy commit mới nhất liên quan đến FILE
        const commitsUrl = `https://api.github.com/repos/${OWNER}/${REPO}/commits?path=${encodeURIComponent(FILE)}&sha=${encodeURIComponent(BRANCH)}&per_page=1`;
        const r = await fetch(commitsUrl, { cache: "no-store" });
        const arr = await r.json();
        const sha = arr[0]?.sha;
        if (!sha) {
          document.getElementById("meta").textContent = "Không tìm thấy commit mới nhất!";
          return;
        }

        // 2) Gắn SHA vào raw URL để load ảnh đúng commit (không cache)
        const raw = `https://raw.githubusercontent.com/${OWNER}/${REPO}/${sha}/${FILE}`;
        document.getElementById("card").src = raw;
        document.getElementById("meta").textContent = `Commit: ${sha.slice(0, 7)}…`;
      } catch (err) {
        document.getElementById("meta").textContent = "Lỗi: " + err;
      }
    }

    // Tải ngay khi mở trang
    showNewest();
    // Auto refresh mỗi 10s (bạn có thể giảm xuống 5s)
    setInterval(showNewest, 10000);
  </script>
</body>
</html>
